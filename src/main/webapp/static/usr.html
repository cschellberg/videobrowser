<html>

<head>
<title>User Services</title>
<script src="js/angular.js"></script>
<script src="js/menu.js"></script>
<script>
	userApp.controller('UserListController', function($scope, $http) {
		$scope.listUsers = function() {
			$http.get("/vb/admin/user/list").then(function mySuccess(response) {
				$scope.users = response.data;
			}, function myError(response) {
				$scope.users = response.text;
			});
		}
		$scope.delete = function(username) {
			$http.delete("/vb/admin/user/delete/"+username).then(function mySuccess(response) {
				window.location.reload();
				$scope.listResponse = response.data;
			}, function myError(response) {
				window.location.reload();
				$scope.listResponse = response.statusText;
			});
		}
	});

	userApp.controller('UserSaveController', function($scope, $http) {
		$scope.reset = function() {
			alert("test");
		}
		$scope.save = function(user) {
			$scope.saveResponse="";
			var url="/vb/user"
			var config = {
	                headers : {
	                    'Content-Type': 'application/json'
	                }
	            }
			var data=JSON.stringify(user);
			$http.post(url, data, config)
			   .then(
			       function(response){
			    	   $scope.saveResponse = response.data;
			       }, 
			       function(response){
			    	   $scope.saveResponse =  response.error;
			       }
			    );
		}
	});
</script>
<link rel="stylesheet" href="css/eliga.css">
</head>

<body ng-app="userApp" onLoad="pickView()">
<div ng-include="'mnu.html'"></div>

	<div id="user_list" style="visibility: hidden" class="main_div">
		<div ng-controller="UserListController" ng-init="listUsers()">
{{listResponse}}
			<table class="eligaTable">
				<thead>
					<tr>
						<th>FirstName</th>
						<th>Last Name</th>
						<th>User Name</th>
						<th>Password</th>
						<th>Role</th>
					</tr>
				</thead>
				<tr ng-repeat="user in users">
					<td>{{ user.firstName }}</td>
					<td>{{user.lastName}}</td>
					<td>{{user.username}}</td>
					<td>{{user.password}}</td>
					<td>{{user.role}}</td>
					<td><button ng-click="delete(user.username)">Delete</button></td>
				</tr>
			</table>
		</div>
	</div>

	<div id="user_save" style="visibility: hidden" class="main_div">
		<div ng-controller="UserSaveController">
		{{saveResponse}}
			<form id="user_form"  >
			<table>
			  <tr><td><label>First Name: <input type="text" ng-model="user.firstName" /></label></td></tr>
				<tr><td><label>Last Name: <input type="text" ng-model="user.lastName" /></label></td></tr> 
				<tr><td><label>User Name: <input type="text" ng-model="user.username" /></label></td></tr> 
				<tr><td><label>Password: <input type="text" ng-model="user.password" /></label></td></tr> 
				<tr><td><input type="button" ng-click="reset()" value="Reset" /> 
				<input type="button"  ng-click="save(user)" value="Save" /></td></tr>
			</table>	
			</form>
		</div>
	</div>

</body>
</html>